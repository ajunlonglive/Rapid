<?xml version="1.0" encoding="UTF-8" ?>
<actions xmlVersion="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../schemas/action.xsd">

<!-- 

Copyright (C) 2020 - Gareth Edwards / Rapid Information Systems

gareth.edwards@rapid-is.co.uk

This file is part of the Rapid Application Platform

Rapid is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version. The terms require you to include
the original copyright, and the license notice in all redistributions.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
in a file named "COPYING".  If not, see <http://www.gnu.org/licenses/>.

 -->

    <action>
    
        <type>rapid</type>
        <name>Rapid</name>
	    <class>com.rapid.actions.Rapid</class>
	    <helpHtml>These actions are used by the Rapid Admin application.</helpHtml>
	    <visible>false</visible>
	    
	    <properties>
	        <property>
	            <key>actionType</key>
	            <name>Type</name>
	            <setConstructValueFunction>return "NONE";</setConstructValueFunction>
	            <changeValueJavaScript>select</changeValueJavaScript>
	            <getValuesFunction>
	                <![CDATA[
return [
 ["NONE","None"],
 ["GETAPPS","Get applications"],
 ["GETVERSIONS","Get versions"],
 ["GETVERSION","Get version"],
 ["GETWORKFLOW","Get workflow"],
 ["GETDBCONN","Get database connection details"],
 ["GETSOA","Get soa webservice details"],
 ["GETSEC","Get security details"],  
 ["GETUSERS","Get users"],
 ["GETUSER","Get user details"],
 ["GETSESSIONS","Get session details"],
 ["GETPARAM","Get parameter details"],
 ["GETRESOURCE","Get resource details"],
 ["GETDEVICE","Get device details"],
 ["GETPROCESSES","Get processes"],
 ["GETPROCESS","Get process"],
 ["GETRAPIDLOG","Get Rapid log"],
 ["RELOADACTIONS","Reload actions"],
 ["RELOADCONTROLS","Reload controls"],
 ["RELOADAPPLICATIONS","Reload applications"], 
 ["RELOADADAPTERS","Reload adapters"],
 ["RELOADPROCESSES","Reload processes"],
 ["RELOADVERSION","Reload version"],
 ["SAVEAPP","Save application details"], 
 ["SAVESTYLES","Save styles"],
 ["SAVEFUNCTIONS","Save functions"],  
 ["SAVEDBCONN","Save database connection"],
 ["SAVESOASQL","Save SQL webservice"],
 ["SAVESOAJAVA","Save Java webservice"],
 ["SAVESECURITYADAPT","Save security adapter"],
 ["SAVEACTIONS","Save actions"],
 ["SAVECONTROLS","Save controls"],    
 ["NEWAPP","New application"],
 ["DELAPP","Delete application"], 
 ["DUPAPP","Duplicate application version"],
 ["NEWVERSION","New application version"],
 ["DELVERSION","Delete application version"], 
 ["NEWWORKFLOW","New workflow"],
 ["DELWORKFLOW","Delete workflow"], 
 ["NEWPAGE","New page"],
 ["DELPAGE","Delete page"],
 ["NEWDBCONN","New database connection"],
 ["DELDBCONN","Delete database connection"],
 ["NEWSOA","New SOA webservice"],
 ["DELSOA","Delete SOA webservice"],
 ["NEWROLE","New role"],
 ["DELROLE","Delete role"],
 ["SAVEROLE","Save role description"],
 ["NEWUSER","New user"],
 ["DELUSER","Delete user"],
 ["NEWUSERROLE","New user role"],
 ["DELUSERROLE","Delete user role"],
 ["SAVEUSER","Save user description, email, password, device, and roles"],
 ["CHECKPASSWORDCOMPLEXITY","Check password complexity"],
 ["NEWPARAM","New parameter"],
 ["DELPARAM","Delete parameter"],
 ["SAVEPARAM","Save parameter"],
 ["NEWRESOURCE","New resource"],
 ["DELRESOURCE","Delete resource"],
 ["SAVERESOURCE","Save resource"],
 ["NEWDEVICE","New device"],
 ["DELDEVICE","Delete device"],
 ["SAVEDEVICE","Save device"],
 ["REBUILDPAGES","Rebuild application pages"],
 ["TESTDBCONN","Test database connection"],
 ["TESTEMAIL","Test SMTP server"],
 ["SAVEEMAIL","Save SMTP server details"],
 ["DELAPPBACKUP","Delete application backup"],
 ["DELPAGEBACKUP","Delete page backup"],
 ["RESTOREAPPBACKUP","Restore application backup"],
 ["RESTOREPAGEBACKUP","Restore page backup"],
 ["SAVEAPPBACKUPSIZE","Save number of application backups"],
 ["SAVEPAGEBACKUPSIZE","Save number of page backups"],
 ["ADDADMINUSER","Add Rapid Admin user to the app"],
 ["NEWPROCESS","New process"],
 ["DELPROCESS","Delete"],
 ["SAVEPROCESS","Save process"]
];
					]]>
	            </getValuesFunction>  
	        </property>
	        <property>
	            <key>rapidApp</key>
	            <name>Rapid application</name>
	            <changeValueJavaScript>checkbox</changeValueJavaScript>	 
	        </property>
	        <property>
	            <key>successActions</key>
	            <name>Success actions</name>
	            <changeValueJavaScript>childActions</changeValueJavaScript>	 
	        </property>
	        <property>
	            <key>errorActions</key>
	            <name>Error actions</name>
	            <changeValueJavaScript>childActions</changeValueJavaScript>	 
	        </property>	 
	    </properties>
	    
	    <resources>
	        <resource>
	            <type>javascriptFile</type>
	            <contents>scripts/soa.js</contents>
	        </resource>
	        <resource>
	            <type>javascriptFile</type>
	            <contents>scripts/reorder.js</contents>
	        </resource>
	        <resource>
	            <type>javascriptFile</type>
	            <contents>scripts/properties.js</contents>
	        </resource>
	        <resource>
	            <type>cssFile</type>
	            <contents>styles/properties.css</contents>
	        </resource>
	    </resources>
	    
	    <actionJavaScript>
	        <![CDATA[

// a global for holding the userName which we get when calling GETAPPS	        
var _userName = "";	        
	        
function Action_rapid(ev, appId, pageId, controlId, actionId, actionType, rapidApp, successCallback, errorCallback) {

	var type = "GET";
	
	var data = null;
	var callback = null;
	
	// get a ref to the control that iniated this action	
	var target = $(ev.target);
	// disable it if a button
	if (target.is("button")) target.disable();

	// some special types require data and callbacks	
	switch (actionType) {
		case "GETAPPS" :		
			data = { actionType: actionType, appId: "rapid" };	
			callback = function(data) {			
				setData_dataStore(ev,'rapid_P0_C210', null, {storageType:"S"}, data);									
			};
		break;
		case "GETVERSIONS" :	
			var appId = $("#rapid_P0_C43").val();
			if (appId) {
				data = { actionType: actionType, appId: appId  };	
				callback = function(data) {
					setData_dataStore(ev, 'rapid_P0_C1063_', "versions", {storageType:"S"}, data);
				};
			} else {
				return false;
			}
		break;
		case "GETVERSION" :		
			var appId = $("#rapid_P0_C43").val();
			var version = $("#rapid_P0_C1044_").val();
			if (appId && version) {
				data = { actionType: actionType, appId: appId, version: version };	
				callback = function(data) {
					setData_dataStore(ev, 'rapid_P0_C1072_', null, {storageType:"S"}, data);
				};
			} else {
				return false;
			}
		break;
		case "GETWORKFLOW" :		
			var wfId = $("#rapid_P0_C2079_").val();
			if (wfId) {
				data = { actionType: actionType, wfId: wfId, appId: "rapid" };	
				callback = function(data) {
					setData_dataStore(ev, 'rapid_P0_C2310_', null, {storageType:"S"}, data);
				};
			} else {
				return false;
			}
		break;	
		case "GETDBCONN" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C311").find("tr.rowSelect").index()-1 };	
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C361', "databaseConnection", {storageType:"S"}, data);
			};
		break;
		case "GETSOA" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C483_").find("tr.rowSelect").index()-1 };	
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C528_', "webservice", {storageType:"S"}, data);
				loadSOA(data.webservice);
			};
		break;
		case "GETSEC" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), securityAdapter: $("#rapid_P0_C81").val() };	
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C469_', "security", {storageType:"S"}, data);
			};
		break;					
		case "GETUSERS" :		
			data = { actionType: actionType, appId: "rapid" };	
			callback = function(data) {			
				setData_grid(ev, 'rapid_P0_C823_', 'users', {"rowSelect":true,"columns":[{"field":"name","visible":true},{"field":"description","visible":true},{"cellFunction":"","field":"","visible":true,"style":""}]}, data);
				if (data.hasMaster) {
					var users = makeDataObject(data, 'users');
					if (users && users.fields && users.rows && users.fields.length > 1 && users.rows.length > 1) {
						var temp = users.fields[0];
						users.fields[0] = users.fields[1];
						users.fields[1] = temp;
						for (var i in users.rows) {
							temp = users.rows[i][0];
							users.rows[i][0] = users.rows[i][1];
							users.rows[i][1] = temp;
							if (users.rows[i][0]) {
								users.rows[i][0] = users.rows[i][1] + " - " + users.rows[i][0];
							} else {
								users.rows[i][0] = users.rows[i][1];
							}
						}
						setData_dropdown(ev, 'rapid_P0_C3193_', null, rapid_P0_C3193_details, users);
					}
				}
				if (getData_dataStore(null, "rapid_P0_C210", "canManageUsers", rapid_P0_C210details)) {
					var rapidUserRows = $("#rapid_P0_C823_").find("tr.rowStyle1,tr.rowStyle2");
					rapidUserRows.each( function() {
					  var children = $(this).children("td");
					  var user = children.first().html();
					  if (data.currentUser.toLowerCase() != user.toLowerCase()) {
						  var cell = children.last();
						  cell.html("<button>delete...</button>");
						  cell.find("button").click( function(ev) {
						    // confirm
						    if (confirm("Are you sure?")) {    
						      Action_rapid(ev, 'rapid', 'P0', null, 'P0_A904_', 'DELUSER', true);					      
						    }
						    // stop bubbling
						    ev.stopPropagation();
						  });
					   }
					});
				}
			};
		break;
		case "GETUSER" :	
			if (rapidApp) {
				data = { actionType: actionType, appId: "rapid", version: _appVersion, userName: getData_grid(ev, "rapid_P0_C823_", "name", {columns:[{field:"name"}]}) };
			} else {
				data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: getData_grid(ev, "rapid_P0_C216", "userName", {columns:[{field:"userName"}]}) };	
			}
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C243', "user", {storageType:"S"}, data);
			};
		break;	
		case "GETPARAM" :	
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C1108_").find("tr.rowSelect").index()-1 };
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C1145_', "parameter", {storageType:"S"}, data);
			};
		break;
		case "GETRESOURCE" :	
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C1344_").find("tr.rowSelect").index()-1 };
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C1401_', "resource", {storageType:"S"}, data);
			};
		break;
		case "GETDEVICE" :	
			data = { actionType: actionType, appId: "rapid", version: _appVersion, index: $("#rapid_P0_C1199_").find("tr.rowSelect").index()-1 };
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C1269_', "device", {storageType:"S"}, data);
			};
		break;
		case "GETPROCESSES" :
			data = { actionType: actionType, appId: "rapid" };
			callback = function(data) {
				if (data && data.processes) {
					data = {
						fields: ["name"],
						rows: data.processes.map(function(process) { return [process]; })
					};
					Action_datacopy(
						ev,
						data,
						[{
							id:'rapid_P0_C3325_',
							type:'grid',
							field:'',
							details:rapid_P0_C3325_details
						}],
						false
					);
				}
			};
		break;
		case "GETPROCESS" :
			data = { actionType: actionType, appId: "rapid", processName: getProperty_grid_selectedRowData(ev,'rapid_P0_C3325_','name',rapid_P0_C3325_details) };
			callback = function(data) {
				
				Action_datacopy(
					ev,
					data.className,
					[{
						id:'rapid_P0_C3356_',
						type:'input',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.interval,
					[{
						id:'rapid_P0_C3357_',
						type:'input',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.interval > 0,
					[{
						id: 'rapid_P0_C3435_',
						type: 'checkbox',
						field: ''}],
					true,
					'replace'
				);
				Action_datacopy(
					ev,
					data.duration && data.duration.start,
					[{
						id:'rapid_P0_C3358_',
						type:'input',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.duration && data.duration.stop,
					[{
						id:'rapid_P0_C3359_',
						type:'input',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.days ? data.days.monday : false,
					[{
						id:'rapid_P0_C3364_',
						type:'checkbox',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.days ? data.days.tuesday : false,
					[{
						id:'rapid_P0_C3373_',
						type:'checkbox',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.days ? data.days.wednesday : false,
					[{
						id:'rapid_P0_C3376_',
						type:'checkbox',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.days ? data.days.thursday : false,
					[{
						id:'rapid_P0_C3379_',
						type:'checkbox',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.days ? data.days.friday : false,
					[{
						id:'rapid_P0_C3382_',
						type:'checkbox',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.days ? data.days.saturday : false,
					[{
						id:'rapid_P0_C3385_',
						type:'checkbox',
						field:''
					}],
					false
				);
				Action_datacopy(
					ev,
					data.days ? data.days.sunday : false,
					[{
						id:'rapid_P0_C3388_',
						type:'checkbox',
						field:''
					}],
					false
				);
				var data = {
					fields: ["name", "value"],
					rows: data.parameters && data.parameters.map(function(parameter) {
						return [parameter.name, parameter.value];
					}) || []
				};
				Action_datacopy(
					ev,
					data,
					[{
						id:'rapid_P0_C3389_',
						type:'grid',
						field:'',
						details:rapid_P0_C3389_details
					}],
					false
				);
			};
		break;
		case "GETSESSIONS" :	
			data = { actionType: actionType, appId: "rapid", version: _appVersion };
			callback = function(data) {
				setData_grid(ev, 'rapid_P0_C1485_', "sessions", rapid_P0_C1485_details, data);
			};
		break;
		case "GETRAPIDLOG" :	
			data = { actionType: actionType, appId: "rapid", version: _appVersion, nLines: getData_radiobuttons(ev, "rapid_P0_C3543_") };
			callback = function(data) {
				if (data && data.lines) {
					var lines = data.lines;
					var firstLineIndex = data.firstLineIndex;
					var nLines = lines.length;
					
					var reorderedLines = lines.slice(firstLineIndex, nLines).concat(lines.slice(0, firstLineIndex));
					
					var log = "<ul>"
					
					log += reorderedLines.map(function(line) {
						return "<li>" + line + "</li>";
					}).join("");
					
					log += "</ul>";
					setData_text(ev, 'rapid_P0_C3534_', null, rapid_P0_C1485_details, log);
				}
			};
		break;
		case "RELOADVERSION" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val()
			};	
		break;
		case "SAVEAPP" :		
			data = { 
				actionType: actionType,
				appId: $("#rapid_P0_C43").val(),
				version: $("#rapid_P0_C1044_").val(),
				status: $("#rapid_P0_C1098_").val(),
				name: $("#rapid_P0_C392_").val(),
				saveVersion: $("#rapid_P0_C1077_").val(),
				title: $("#rapid_P0_C394_").val(),
				description: $("#rapid_P0_C393_").val(),

				isForm: getData_checkbox(ev, "rapid_P0_C1826_"), 
				startPageId: $("#rapid_P0_C644_").val(),
				showControlIds: getData_checkbox(ev, "rapid_P0_C381_"),
				showActionIds: getData_checkbox(ev, "rapid_P0_C382_"),		
				pageNameIds: getData_checkbox(ev, "rapid_P0_C2409_"),
				isHidden: getData_checkbox(ev, "rapid_P0_C3209_"), 
				
				formAdapter: $("#rapid_P0_C1406_").val(),
				formShowSummary: getData_checkbox(ev, "rapid_P0_C3202_"),
				formDisableAutoComplete: getData_checkbox(ev, "rapid_P0_C3086_"),
				
				formEmail: getData_checkbox(ev, "rapid_P0_C1874_"),
				formEmailFrom: $("#rapid_P0_C1994_").val(),
				formEmailTo: $("#rapid_P0_C1875_").val(),
				formEmailAttachmentType: $("#rapid_P0_C1876_").val(),

				formEmailCustomer: getData_checkbox(ev, "rapid_P0_C3009_"),
				formEmailCustomerControlId: $("#rapid_P0_C3048_").val(),
				formEmailCustomerSubject: $("#rapid_P0_C3136_").val(),
				formEmailCustomerType: getData_radiobuttons(ev, "rapid_P0_C3047_"),
				formEmailCustomerBody: _codeEditors["rapid_P0_C3153_"].getValue(),
				formEmailCustomerAttachmentType: $("#rapid_P0_C3063_").val(),
				
				formFile: getData_checkbox(ev, "rapid_P0_C1878_"),
				formFileType: $("#rapid_P0_C1897_").val(),
				formFilePath: $("#rapid_P0_C1898_").val(),
				formFileUserName: $("#rapid_P0_C1899_").val(),
				formFilePassword: $("#rapid_P0_C1900_").val(),
				
				formWebservice: getData_checkbox(ev, "rapid_P0_C1905_"),
				formWebserviceURL: $("#rapid_P0_C1903_").val(),
				formWebserviceType: $("#rapid_P0_C1902_").val(),
				formWebserviceSOAPAction: $("#rapid_P0_C1901_").val()
				
			};	
		break;
		case "SAVESTYLES" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				themeType: $("#rapid_P0_C1570_").val(), 
				styles: _codeEditors["rapid_P0_C2809_"].getValue(),
				statusBarColour: $("#rapid_P0_C1414_").val(), 
				statusBarHighlightColour: $("#rapid_P0_C1418_").val(), 
				statusBarTextColour: $("#rapid_P0_C1415_").val(), 
				statusBarIconColour: $("#rapid_P0_C1416_").val() 
			};	
		break;		
		case "SAVEFUNCTIONS" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), functions: $("#rapid_P0_C1292_").val() };	
		break;	
		case "SAVEDBCONN" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				index: $("#rapid_P0_C311").find("tr.rowSelect").index()-1,
				name: $("#rapid_P0_C360").val(),
				driver: $("#rapid_P0_C338").val(),
				connectionString: $("#rapid_P0_C374").val(),
				connectionAdapter: $("#rapid_P0_C339").val(),
				userName: $("#rapid_P0_C340").val(),
				password: $("#rapid_P0_C341").val()
			};	
			callback = function() {
				Event_click_rapid_P0_C311({target: $("#rapid_P0_C311").find("tr.rowSelect").children().first()[0] });
			};
		break;
		case "SAVESOASQL" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				index: $("#rapid_P0_C483_").find("tr.rowSelect").index()-1,
				name: $("#rapid_P0_C496_").val(), 
				databaseConnectionIndex: $("#rapid_P0_C536_")[0].selectedIndex,
				details: _soaDetails,
				type: "SQLWebservice"
			};	
		break;
		case "SAVESOAJAVA" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				index: $("#rapid_P0_C483_").find("tr.rowSelect").index()-1,
				name: $("#rapid_P0_C944_").val(), 
				className: $("#rapid_P0_C989_").val(),
				type: "JavaWebservice"
			};	
		break;
		case "SAVESECURITYADAPT" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				securityAdapter: $("#rapid_P0_C81").val(),
				deviceSecurity: getData_checkbox(ev, "rapid_P0_C1591_"),
				storePasswordDuration: $("#rapid_P0_C1621_").val()
			};	
		break;
		case "SAVEACTIONS" :
			var actionTypes = [];
			$("#rapid_P0_C288").find("input:checked:not(gridMultiSelectHeader)").each( function(){
				actionTypes.push($(this).closest("tr").children("td:nth-child(2)").html());
			});		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), actionTypes: actionTypes };	
		break;
		case "SAVECONTROLS" :	
			var controlTypes = [];
			$("#rapid_P0_C289").find("input:checked:not(gridMultiSelectHeader)").each( function(){
				controlTypes.push($(this).closest("tr").children("td:nth-child(2)").html());
			});		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), controlTypes: controlTypes };	
		break;
		case "REBUILDPAGES" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val() };	
		break;
		case "NEWAPP" :
			data = {
				actionType: actionType,
				appId: "rapid",
				version: "1",
				name: $("#rapid_P1_C7").val(),
				newVersion: $("#rapid_P1_C48_").val(),
				title: $("#rapid_P1_C11").val(),
				type: $("#rapid_P1_C57_").find("input[type=radio]:checked").val(),
				formAdapter: $("#rapid_P1_C98_").val(),
				responsive: getData_checkbox(ev, "rapid_P1_C70_"),
				themeType: $("#rapid_P1_C63_").val(),
				description: $("#rapid_P1_C15").val()
			}
			callback = function(response) {
				window.location = "~?a=rapid&p=P0&appId=" + response.appId + "&version=" + response.version;
			}; 
		break;
		case "DELAPP" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val() 
			};	
			callback = function() {
				window.location = "~?a=rapid&p=P0";
			}; 			
		break;		
		case "DUPAPP" :		
			data = {
				actionType: actionType,
				appId: $("#rapid_P0_C43").val(),
				version: $("#rapid_P0_C1044_").val(),
				newVersion: $("#rapid_P8_C7_").val(),
				title: $("#rapid_P8_C12_").val(),
				description: $("#rapid_P8_C17_").val()
			}
			callback = function(response) {
				var url = "~?a=rapid&p=P0";
				if (response.id) url += "&appId=" + response.id;
				if (response.version) url += "&version=" + response.version;
				window.location = url;
			}; 			
		break;				
		case "NEWVERSION" :		
			data = {
				actionType: actionType,
				appId: $("#rapid_P0_C43").val(),
				version: $("#rapid_P0_C1044_").val(),
				newVersion: $("#rapid_P17_C7_").val(),
				title: $("#rapid_P17_C12_").val(),
				description: $("#rapid_P17_C17_").val()
			}
			callback = function(response) {
				var url = "~?a=rapid&p=P0";
				if (response.id) url += "&appId=" + response.id;
				if (response.version) url += "&version=" + response.version;
				window.location = url;
			}; 			
		break;		
		case "DELVERSION" :		
			data = {
				actionType: actionType,
				appId: $("#rapid_P0_C43").val(),
				version: $("#rapid_P0_C1044_").val()
			}
			callback = function(response) {
				location.reload();
			}; 			
		break;
		case "NEWWORKFLOW" :
			data = {
				actionType: actionType,
				appId: "rapid",
				version: "1",
				name: $("#rapid_P19_C7").val(),
				title: $("#rapid_P19_C11").val(),
				description: $("#rapid_P19_C15").val()
			}
			callback = function(response) {
				window.location = "~?a=rapid&p=P0&wfId=" + response.wfId;
			}; 
		break;
		case "DELWORKFLOW" :		
			data = { 
				actionType: actionType, 
				id: $("#rapid_P0_C2079_").val() 
			};	
			callback = function() {
				window.location = "~?a=rapid&p=P0&wfId=";
			}; 			
		break;				
		case "NEWPAGE" :	
			data = {
				actionType: actionType,
				appId: _version.id,
				version: _version.version,
				id: "P" + _nextPageId, 
				name: $("#rapid_P3_C17").val(),
				title: $("#rapid_P3_C18").val(),
				description: $("#rapid_P3_C19").val()
			}
			callback = function(data) {
				hideDialogue();
				loadPages(data.id, true);
			}; 
		break;
		case "DELPAGE" :
			data = { actionType: actionType, appId: _version.id, version: _version.version, id: _page.id }; 
			callback = function() {
				hideDialogue();
				loadPages(null, true);
			}; 
		break;	
		case "NEWDBCONN" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				name: $("#rapid_P7_C7").val(),
				driver: $("#rapid_P7_C37").val(),
				connectionString: $("#rapid_P7_C44").val(),
				connectionAdapter: $("#rapid_P7_C38").val(),  
				userName: $("#rapid_P7_C30").val(),
				password: $("#rapid_P7_C35").val()
			};	
			callback = function() {
				// reload version
				Event_change_rapid_P0_C1044_(ev);
			};	
		break;
		case "DELDBCONN" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $(ev.target).parent().parent().index()-1 };
			callback = function() {
				// reload everything
				Event_change_rapid_P0_C1044_(ev);
			};	
		break;
		case "NEWSOA" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				name: $("#rapid_P10_C8_").val(),
				type: $("#rapid_P10_C23_").val()
			};	
			callback = function() {
				Event_change_rapid_P0_C1044_(ev);
			};	
		break;
		case "DELSOA" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $(ev.target).parent().parent().index()-1 };
			callback = function() {
				Event_change_rapid_P0_C1044_(ev);
			};	
		break;
		case "NEWROLE" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), role: $("#rapid_P5_C7").val(), description: $("#rapid_P5_C41_").val() };
			callback = function() {
				// fake an adapter change
				$("#rapid_P0_C81").change();
				// fake a tab click
				$("#rapid_P0_C74").click(); 
			};								
		break;
		case "DELROLE" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), role: $(ev.target).closest("tr").find("td").first().html() };
			callback = function() {
				// fake an adapter change
				$("#rapid_P0_C81").change(); 
				// fake a tab click
				$("#rapid_P0_C74").click(); 
			};	
		break;
		case "SAVEROLE" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), role: $("#rapid_P0_C222").find("tr.rowSelect").children().first().html(), description: $("#rapid_P0_C735_").val() };
			callback = function() {
				// fake an adapter change
				$("#rapid_P0_C81").change(); 
				// fake a tab click
				$("#rapid_P0_C74").click(); 
			};							
		break;
		case "NEWUSER" :	
			if (rapidApp) {
				data = { actionType: actionType, 
					appId: "rapid", 
					version : _appVersion, 
					userName: $("#rapid_P16_C8_").val(), 
					description: $("#rapid_P16_C13_").val() ,
					email: $("#rapid_P16_C63_").val() ,  
					password: $("#rapid_P16_C17_").val(), 
					isLocked: getData_checkbox(ev, "rapid_P16_C100_"),
					deviceDetails: $("#rapid_P16_C57_").val(),
					useAdmin: getData_checkbox(ev, "rapid_P16_C38_"),
					useMaster: getData_checkbox(ev, "rapid_P16_C118_"),
					useDesign: getData_checkbox(ev, "rapid_P16_C39_"),
					useUsers: getData_checkbox(ev, "rapid_P16_C70_")
				};
			} else {	
				data = { actionType: actionType, 
					appId: $("#rapid_P0_C43").val(), 
					version: $("#rapid_P0_C1044_").val(), 
					userName: $("#rapid_P6_C7").val(), 
					description: $("#rapid_P6_C42_").val(), 
					email: $("#rapid_P6_C77_").val(),
					password: $("#rapid_P6_C18").val(),
					isLocked: getData_checkbox(ev, "rapid_P6_C320_"),
					deviceDetails: $("#rapid_P6_C70_").val(),
					useAdmin: getData_checkbox(ev, "rapid_P6_C65_"),
					useDesign: getData_checkbox(ev, "rapid_P6_C66_"),
					useUsers: getData_checkbox(ev, "rapid_P6_C90_")
				 };
				callback = function() {
					// fire an adapter change
					Event_change_rapid_P0_C81(ev);
				};
			}								
		break;
		case "DELUSER" :		
			if (rapidApp) {
				data = { actionType: actionType, appId: "rapid", userName: $(ev.target).closest("tr").find("td").first().html() };
				callback = function() {			
					// hide any currently displayed user details
					$("#rapid_P0_C827_").hide();	
					// reload users
					Action_rapid(ev, 'rapid', 'P0', null, 'P0_A901_', 'GETUSERS', true);
				};
			} else {
				data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: $(ev.target).closest("tr").find("td").first().html() };
				callback = function() {
					// fire an adapter change
					Event_change_rapid_P0_C81(ev);
					// fake a tab click
					$("#rapid_P0_C74").click();    
				};
			} 											
		break;
		case "NEWUSERROLE" : 
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: $("#rapid_P0_C216").find("tr.rowSelect").children().first().html(), role: $("#rapid_P0_C254").val() };
			callback = function() {
				Event_click_rapid_P0_C216({target: $("#rapid_P0_C216").find("tr.rowSelect").children().first()[0] });
			};																
		break;
		case "DELUSERROLE" :	
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: $("#rapid_P0_C216").find("tr.rowSelect").children().first().html(), role: $(ev.target).parent().prev().html() };
			callback = function() {
				Event_click_rapid_P0_C216({target: $("#rapid_P0_C216").find("tr.rowSelect").children().first()[0] });
			};																
		break;
		case "SAVEUSER" :	
			if (rapidApp) {
				data = { actionType: actionType, appId: "rapid", version: _appVersion, 
					userName: $("#rapid_P0_C834_").text(), 	description: $("#rapid_P0_C838_").val(), email: $("#rapid_P0_C2061_").val(), 
					password: $("#rapid_P0_C843_").val(), deviceDetails: $("#rapid_P0_C1453_").val(), isLocked: getData_checkbox(ev, "rapid_P0_C2915_"), 
					useAdmin: getData_checkbox(ev, "rapid_P0_C879_"),
					useMaster: getData_checkbox(ev, "rapid_P0_C3167_"),  
					useDesign: getData_checkbox(ev, "rapid_P0_C880_"),
					useUsers: getData_checkbox(ev, "rapid_P0_C2442_") 
				}; 
			} else {
				data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), 
					userName: $("#rapid_P0_C216").find("tr.rowSelect").children().first().html(), description: $("#rapid_P0_C717_").val(), email: $("#rapid_P0_C2068_").val(), isLocked: getData_checkbox(ev, "rapid_P0_C2907_"),
					password: $("#rapid_P0_C231").val(), deviceDetails: $("#rapid_P0_C1444_").val() 
				};
				callback = function() {
					// fake an adapter change
					$("#rapid_P0_C81").change(); 
					// fake a tab click
					$("#rapid_P0_C74").click();    
				};	
			}															
		break;
		case "CHECKPASSWORDCOMPLEXITY" :
			// check top level or app level
			if (rapidApp) {				
				// set basic data
				data = { actionType: actionType, appId: "rapid", version: _appVersion};
				// check for new user dialogue				
				if ($("#P16").is(":visible")) {
					// clear any previous validation class
					$("#rapid_P16_C105_").removeClass("validation");
					// add password
					data.password = $("#rapid_P16_C17_").val();
				} else {
					// clear any previous validation class
					$("#rapid_P0_C852_").removeClass("validation");
					// add password
					data.password = $("#rapid_P0_C843_").val();
				} 
			} else {
				// set basic data
				data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val() };
				// check for new user dialouge
				if ($("#P6").is(":visible")) {
					// clear any previous validation class
					$("#rapid_P16_C105_").removeClass("validation");
					// add password
					data.password = $("#rapid_P6_C18").val();
				} else {
					// clear any previous validation class
					$("#rapid_P0_C279").removeClass("validation");
					// add password
					data.password = $("#rapid_P0_C231").val();
				}
			}
			// if password is unchanged 
			if (data.password == "********") {
				// invoke any success callback straight away
				if (successCallback) successCallback(data);
				// we're done
				return true;
			} else {
				// make a callback for after the check password
				callback = function(data, rapidApp) {
					// if we failed to pass the password complexity rules
	 				if (!data.complexPass) {
	 					// check top level or low level
	 					if (data.rapidApp) {
	 						// check for new user dialogue
	 						if ($("#P16").is(":visible")) {
	 							$("#rapid_P16_C105_").html(data.message).addClass("validation"); // top level new user dialogue
	 						} else {
	 							$("#rapid_P0_C852_").html(data.message).addClass("validation"); // top level ammend user
	 						}
	 					} else {
	 						// check for new user dialouge
							if ($("#P6").is(":visible")) {
								// show message and add validation
	 							$("#rapid_P6_C322_").html(data.message).addClass("validation"); // app level new user dialogue
							} else {
								// show message and add validation
	 							$("#rapid_P0_C279").html(data.message).addClass("validation"); // app level ammend user
	 						}
	 					}
	 					return false;
	 				}
				};
			}
		break;
		case "NEWPARAM" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val() };
		break;
		case "DELPARAM" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $(ev.target).closest("tr").index()-1 };
		break;
		case "SAVEPARAM" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C1108_").find("tr.rowSelect").index()-1, name: $("#rapid_P0_C1134_").val(), description: $("#rapid_P0_C2802_").val(), value: $("#rapid_P0_C1123_").val()};
		break;
		case "NEWRESOURCE" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val() };
		break;
		case "DELRESOURCE" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $(ev.target).closest("tr").index()-1 };
		break;
		case "SAVERESOURCE" :
			var value = "";
			//check the type - 
			if($("#rapid_P0_C1398_").val() == "1" || $("#rapid_P0_C1398_").val() == "2"){
				//get the value from the codeEditor
				value = _codeEditors['rapid_P0_C2861_'].getValue();
			}else {
				//get the value from the input box
				value = $("#rapid_P0_C1390_").val();
			}
			
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C1344_").find("tr.rowSelect").index()-1, name: $("#rapid_P0_C1362_").val(), type: $("#rapid_P0_C1398_").val(), value: value};
		break;
		case "NEWDEVICE" :
			data = { actionType: actionType, appId: "rapid", version: _appVersion };
		break;
		case "DELDEVICE" :
			data = { actionType: actionType, appId: "rapid", version: _appVersion, index: $(ev.target).closest("tr").index()-1 };
		break;
		case "SAVEDEVICE" :
			data = { actionType: actionType, appId: "rapid", version: _appVersion, index: $("#rapid_P0_C1199_").find("tr.rowSelect").index()-1, 
			name: $("#rapid_P0_C1243_").val(), 
			width: $("#rapid_P0_C1217_").val(),
			height: $("#rapid_P0_C1248_").val(),
			ppi: $("#rapid_P0_C1253_").val(),
			scale: $("#rapid_P0_C1258_").val()
		};
		break;
		case "TESTDBCONN" :	
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				index: $("#rapid_P0_C311").find("tr.rowSelect").index()-1,
				driver: $("#rapid_P0_C338").val(),
				connectionString: $("#rapid_P0_C374").val(),
				connectionAdapter: $("#rapid_P0_C339").val(),
				userName: $("#rapid_P0_C340").val(),
				password: $("#rapid_P0_C341").val()
			};	
			callback = function(data) {
				alert(data.message);
			};															
		break;
		case "TESTEMAIL" :
			data = {
				actionType: actionType,
				appId: "rapid",
				host: $("#rapid_P0_C1790_").val(),
				port: $("#rapid_P0_C1791_").val(),
				security: $("#rapid_P0_C1794_").val(),
				userName: $("#rapid_P0_C1792_").val(),
				password: $("#rapid_P0_C1793_").val()
			};
			callback = function(data) {
				alert(data.message);
			};
		break;
		case "SAVEEMAIL" :
			data = {
				actionType: actionType,
				appId: "rapid",
				enabled: getData_checkbox(ev, "rapid_P0_C2023_"),
				host: $("#rapid_P0_C1790_").val(),
				port: $("#rapid_P0_C1791_").val(),
				security: $("#rapid_P0_C1794_").val(),
				userName: $("#rapid_P0_C1792_").val(),
				password: $("#rapid_P0_C1793_").val()
			};
		break;
		case "DELAPPBACKUP" : case "RESTOREAPPBACKUP" : 
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				backupId: $("#rapid_P0_C663_").find("tr.rowSelect").children("td").first().text() 
			};	
			callback = function(data) {
				$(data.controlId).hideDialogue();
				Event_change_rapid_P0_C1044_(ev);
				$("#rapid_P0_C662_").click();
			};														
		break;
		case "DELPAGEBACKUP" : case "RESTOREPAGEBACKUP" :	
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				backupId: $("#rapid_P0_C678_").find("tr.rowSelect").children("td").first().text()  
			};	
			callback = function(data) {
				$(data.controlId).hideDialogue();
				Event_change_rapid_P0_C1044_(ev);
				$("#rapid_P0_C662_").click();
			};															
		break;
		case "SAVEAPPBACKUPSIZE" :			
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				backupMaxSize: $("#rapid_P0_C685_").val()  
			};
		break;
		case "SAVEPAGEBACKUPSIZE" :
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				backupMaxSize: $("#rapid_P0_C686_").val()  
			};
		break;
		case "ADDADMINUSER" :
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				user: $("#rapid_P0_C3193_").val()  
			};
		break;
		case "NEWPROCESS" :
			data = { actionType: actionType, appId: "rapid", processName: getData_input(ev,'rapid_P22_C11_',null), processClassName: getData_input(ev,'rapid_P22_C36_',null) };
		break;
		case "DELPROCESS" :
			data = { actionType: actionType, appId: "rapid", processName: getProperty_grid_selectedRowData(ev,'rapid_P0_C3325_','name',rapid_P0_C3325_details) };
		break;
		case "SAVEPROCESS" :
			data = { actionType: actionType, appId: "rapid", processName: getProperty_grid_selectedRowData(ev,'rapid_P0_C3325_','name',rapid_P0_C3325_details),
				details: { 
					className: getData_input(ev,'rapid_P0_C3356_',null),
					interval: getData_input(ev,'rapid_P0_C3357_',null),
					duration: {
						start: getData_input(ev,'rapid_P0_C3358_',null),
						stop: getData_input(ev,'rapid_P0_C3359_',null)
					},
					days: {
						monday: getData_checkbox(ev,'rapid_P0_C3364_',null) || "false",
						tuesday: getData_checkbox(ev,'rapid_P0_C3373_',null) || "false",
						wednesday: getData_checkbox(ev,'rapid_P0_C3376_',null) || "false",
						thursday: getData_checkbox(ev,'rapid_P0_C3379_',null) || "false",
						friday: getData_checkbox(ev,'rapid_P0_C3382_',null) || "false",
						saturday: getData_checkbox(ev,'rapid_P0_C3385_',null) || "false",
						sunday: getData_checkbox(ev,'rapid_P0_C3388_',null) || "false",
					},
					parameters:
						getData_grid(ev,'rapid_P0_C3389_',null,rapid_P0_C3389_details).rows.map(function(row) {
							return { name: row[0], value: row[1] };
						}),
				}
			};
		break;
		default :
			data = { actionType: actionType, appId: "rapid" };
	}
	
	// stringify any data
	if (data) data = JSON.stringify(data);
	
	// run the action on the server	
	$.ajax({
    	url: "~?a=rapid&p=" + pageId + "&act=" + actionId,
    	type: "POST",          
    	dataType: "json",
        data: data,            
        error: function(server, status, error) { 
        	// re-enable target if a button
			if (target.is("button")) target.enable();
			// check security statuses
        	if (server && server.status && (server.status == 401 || server.status == 403)) {
        		window.location = "login.jsp";
        	} else if (errorCallback) {
        		errorCallback(server, status, error);
        	} else {
        		alert(server.responseText || "Error : " + status);
        	}
        },
        success: function(data) {
        	// re-enable target if a button
			if (target.is("button")) target.enable();
       		if (callback) {
       			var result = callback(data);
       			if (result == false) return false;
       		}
       		if (successCallback) successCallback(data);
        }
	});
}	        
			]]>
	    </actionJavaScript>  
	     
    </action> 
</actions>